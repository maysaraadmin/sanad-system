# دليل التثبيت المفصل - نظام السند

## متطلبات النظام

### متطلبات البرمجيات
- **Python**: الإصدار 3.8 أو أحدث
- **pip**: مدير حزم Python
- **Git**: لتحميل المشروع (اختياري)

### متطلبات النظام
- **ذاكرة الوصول العشوائي**: 512 MB كحد أدنى، 1 GB مُوصى به
- **مساحة القرص الصلب**: 100 MB للتطبيق + مساحة إضافية للبيانات
- **نظام التشغيل**: Windows 10+، macOS 10.14+، أو Linux

## خطوات التثبيت التفصيلية

### الخطوة 1: تحضير البيئة

#### على Windows:
```cmd
# تحقق من وجود Python
python --version

# إذا لم يكن مثبتاً، حمله من python.org
# تأكد من تحديد "Add Python to PATH" أثناء التثبيت
```

#### على macOS:
```bash
# تثبيت Homebrew إذا لم يكن مثبتاً
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# تثبيت Python
brew install python
```

#### على Linux (Ubuntu/Debian):
```bash
# تحديث قائمة الحزم
sudo apt update

# تثبيت Python و pip
sudo apt install python3 python3-pip python3-venv

# تثبيت حزم إضافية مطلوبة
sudo apt install python3-dev libpq-dev
```

### الخطوة 2: تحميل المشروع

#### الطريقة الأولى: تحميل ملف ZIP
1. حمل المشروع كملف ZIP
2. استخرج الملفات إلى مجلد `sanad_system`

#### الطريقة الثانية: استخدام Git
```bash
git clone <repository-url>
cd sanad_system
```

### الخطوة 3: إنشاء البيئة الافتراضية

```bash
# إنشاء البيئة الافتراضية
python -m venv venv

# تفعيل البيئة الافتراضية
# على Windows:
venv\Scripts\activate

# على macOS/Linux:
source venv/bin/activate
```

**ملاحظة**: يجب أن ترى `(venv)` في بداية سطر الأوامر بعد التفعيل.

### الخطوة 4: تثبيت المتطلبات

```bash
# ترقية pip
python -m pip install --upgrade pip

# تثبيت المتطلبات
pip install -r requirements.txt
```

### الخطوة 5: إعداد قاعدة البيانات

```bash
# إنشاء ملفات الهجرة
python manage.py makemigrations

# تطبيق الهجرات
python manage.py migrate

# إنشاء مستخدم إداري
python manage.py createsuperuser
```

عند إنشاء المستخدم الإداري، ستُطلب منك المعلومات التالية:
- اسم المستخدم
- البريد الإلكتروني (اختياري)
- كلمة المرور

### الخطوة 6: إنشاء المجلدات المطلوبة

```bash
# إنشاء مجلد الملفات الثابتة
mkdir -p static

# إنشاء مجلد ملفات المستخدمين
mkdir -p media/profile_pics

# إنشاء مجلد السجلات
mkdir -p logs
```

### الخطوة 7: جمع الملفات الثابتة (للإنتاج)

```bash
python manage.py collectstatic
```

### الخطوة 8: تشغيل الخادم

```bash
# تشغيل خادم التطوير
python manage.py runserver

# أو تحديد منفذ مخصص
python manage.py runserver 8080
```

الآن يمكنك الوصول للتطبيق على:
- **الموقع الرئيسي**: http://127.0.0.1:8000
- **لوحة الإدارة**: http://127.0.0.1:8000/admin

## إعداد البيانات الأولية

### إضافة بيانات تجريبية

```bash
# إنشاء ملف fixtures (اختياري)
python manage.py dumpdata --indent 2 > initial_data.json

# تحميل بيانات أولية
python manage.py loaddata initial_data.json
```

### إضافة تصنيفات الأحاديث

يمكنك إضافة تصنيفات أساسية من لوحة الإدارة:
1. اذهب إلى `/admin`
2. سجل دخولك بحساب الإدارة
3. اختر "تصنيفات الأحاديث"
4. أضف تصنيفات مثل: العقيدة، العبادات، المعاملات، الأخلاق

## استكشاف الأخطاء وحلها

### مشاكل شائعة وحلولها

#### خطأ: "No module named 'django'"
```bash
# تأكد من تفعيل البيئة الافتراضية
source venv/bin/activate  # Linux/Mac
venv\Scripts\activate     # Windows

# أعد تثبيت المتطلبات
pip install -r requirements.txt
```

#### خطأ: "Permission denied"
```bash
# على Linux/Mac، استخدم sudo للصلاحيات
sudo python manage.py migrate

# أو غير صلاحيات المجلد
chmod -R 755 sanad_system/
```

#### خطأ: "Port already in use"
```bash
# استخدم منفذ مختلف
python manage.py runserver 8080

# أو أوقف العملية المستخدمة للمنفذ
# على Windows:
netstat -ano | findstr :8000
taskkill /PID <PID> /F

# على Linux/Mac:
lsof -ti:8000 | xargs kill -9
```

#### خطأ: "Database is locked"
```bash
# أوقف جميع عمليات Django
# احذف ملف db.sqlite3
rm db.sqlite3

# أعد إنشاء قاعدة البيانات
python manage.py migrate
python manage.py createsuperuser
```

### فحص التثبيت

```bash
# فحص إصدار Django
python -m django --version

# فحص إعدادات المشروع
python manage.py check

# فحص قاعدة البيانات
python manage.py showmigrations
```

## إعدادات الإنتاج

### تحديث settings.py للإنتاج

```python
# في settings.py
DEBUG = False
ALLOWED_HOSTS = ['your-domain.com', 'www.your-domain.com']

# إعدادات الأمان
SECURE_BROWSER_XSS_FILTER = True
SECURE_CONTENT_TYPE_NOSNIFF = True
SECURE_HSTS_SECONDS = 31536000
SECURE_HSTS_INCLUDE_SUBDOMAINS = True
SECURE_HSTS_PRELOAD = True
SECURE_SSL_REDIRECT = True
SESSION_COOKIE_SECURE = True
CSRF_COOKIE_SECURE = True

# إعدادات قاعدة البيانات للإنتاج (PostgreSQL)
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'sanad_db',
        'USER': 'sanad_user',
        'PASSWORD': 'your_password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}
```

### استخدام متغيرات البيئة

```bash
# إنشاء ملف .env
echo "SECRET_KEY=your-secret-key-here" > .env
echo "DEBUG=False" >> .env
echo "DATABASE_URL=postgresql://user:pass@localhost/dbname" >> .env
```

### تثبيت خادم الإنتاج

```bash
# تثبيت Gunicorn
pip install gunicorn

# تشغيل الخادم
gunicorn sanad_system.wsgi:application --bind 0.0.0.0:8000
```

## النسخ الاحتياطي والاستعادة

### إنشاء نسخة احتياطية

```bash
# نسخ احتياطية لقاعدة البيانات
python manage.py dumpdata > backup.json

# نسخ احتياطية للملفات المرفوعة
tar -czf media_backup.tar.gz media/
```

### استعادة النسخة الاحتياطية

```bash
# استعادة قاعدة البيانات
python manage.py loaddata backup.json

# استعادة الملفات المرفوعة
tar -xzf media_backup.tar.gz
```

## الصيانة الدورية

### تنظيف الجلسات المنتهية الصلاحية

```bash
python manage.py clearsessions
```

### تحديث الفهارس

```bash
python manage.py migrate --run-syncdb
```

### فحص الأمان

```bash
python manage.py check --deploy
```

## الدعم الفني

إذا واجهت أي مشاكل أثناء التثبيت:

1. **تحقق من السجلات**: راجع ملفات السجلات في مجلد `logs/`
2. **فحص الإعدادات**: تأكد من صحة إعدادات `settings.py`
3. **البحث عن الحلول**: ابحث عن رسالة الخطأ في محركات البحث
4. **طلب المساعدة**: أنشئ issue في مستودع المشروع

---

بعد اتباع هذه الخطوات، يجب أن يكون نظام السند جاهزاً للاستخدام!

